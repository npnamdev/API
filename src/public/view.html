<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>Prism JSON Formatter - Qu·∫£n l√Ω API</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Theme tr·∫Øng Prism -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/components/prism-json.min.js"></script>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }
  </style>
</head>

<body class="bg-white text-black h-dvh flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-md p-5 border-b border-gray-300">
    <div class="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-3">
      <h1 class="text-2xl font-extrabold">üîß JSON Formatter</h1>
      <p class="text-gray-600 text-sm sm:text-base">Nh·∫≠p URL API v√† xem JSON ƒë·ªãnh d·∫°ng ƒë·∫πp ngay b√™n d∆∞·ªõi</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 p-6 max-w-4xl mx-auto w-full flex flex-col">
    <!-- API Input -->
    <label for="apiInput" class="mb-2 text-sm font-medium">üîó Nh·∫≠p ƒë∆∞·ªùng d·∫´n API:</label>
    <div class="flex gap-3 mb-4 items-center">
      <input id="apiInput" type="text" placeholder="https://api.example.com/data"
        class="flex-grow p-3 rounded-md bg-gray-100 border border-gray-300 focus:border-blue-500 focus:outline-none transition text-black placeholder-gray-400" />
      <button onclick="fetchApiData()"
        class="px-5 py-3 bg-blue-600 hover:bg-blue-500 rounded-md font-semibold transition select-none text-white">T·∫£i</button>
    </div>

    <!-- Status -->
    <p id="status" class="min-h-[24px] text-sm text-gray-600 mb-6"></p>

    <!-- JSON Display -->
    <div id="jsonContainer"
      class="mb-6 overflow-auto max-h-[70vh] rounded-md border border-gray-300 shadow-inner bg-white">
      <pre id="jsonDisplay" class="language-json whitespace-pre font-mono text-base p-6 text-black"></pre>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-300 p-4 text-center text-sm text-gray-500 select-none">
    &copy; 2025 Prism JSON Formatter. All rights reserved.
  </footer>

  <!-- Script -->
  <script>
    const LS_KEY = 'lastJsonData';
    const LS_API_KEY = 'lastApiUrl';

    async function fetchApiData() {
      const apiInput = document.getElementById('apiInput');
      const api = apiInput.value.trim();
      const jsonDisplay = document.getElementById('jsonDisplay');
      const status = document.getElementById('status');

      if (!api) {
        status.textContent = '‚ùå Vui l√≤ng nh·∫≠p ƒë∆∞·ªùng d·∫´n API!';
        jsonDisplay.textContent = '';
        return;
      }

      status.textContent = '‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...';
      jsonDisplay.textContent = '';

      try {
        const response = await fetch(api);

        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const contentType = response.headers.get("content-type");
        if (contentType && contentType.includes("application/json")) {
          const data = await response.json();
          const formatted = JSON.stringify(data, null, 2);
          jsonDisplay.textContent = formatted;
          Prism.highlightElement(jsonDisplay);
          status.textContent = '‚úÖ T·∫£i d·ªØ li·ªáu th√†nh c√¥ng.';

          // L∆∞u v√†o localStorage
          localStorage.setItem(LS_KEY, formatted);
          localStorage.setItem(LS_API_KEY, api);
        } else {
          throw new Error("Ph·∫£n h·ªìi kh√¥ng ph·∫£i JSON!");
        }
      } catch (err) {
        jsonDisplay.textContent = '';
        status.textContent = '‚ùå L·ªói khi g·ªçi API: ' + err.message;
        console.error("L·ªói fetchApiData:", err);
      }
    }

    // Load JSON v√† API t·ª´ localStorage khi load trang
    window.onload = function () {
      const savedJson = localStorage.getItem(LS_KEY);
      const savedApi = localStorage.getItem(LS_API_KEY);
      const apiInput = document.getElementById('apiInput');
      const jsonDisplay = document.getElementById('jsonDisplay');
      const status = document.getElementById('status');

      if (savedApi) {
        apiInput.value = savedApi;
      }

      if (savedJson) {
        jsonDisplay.textContent = savedJson;
        Prism.highlightElement(jsonDisplay);
        status.textContent = 'üíæ D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u t·∫°m th·ªùi.';
      }
    }
  </script>
</body>

</html>